#!/bin/sh

# Copyright (c) 2000-2020, Board of Trustees of Leland Stanford Jr. University
# All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are met:
#
# 1. Redistributions of source code must retain the above copyright notice,
# this list of conditions and the following disclaimer.
#
# 2. Redistributions in binary form must reproduce the above copyright notice,
# this list of conditions and the following disclaimer in the documentation
# and/or other materials provided with the distribution.
#
# 3. Neither the name of the copyright holder nor the names of its contributors
# may be used to endorse or promote products derived from this software without
# specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
# ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
# LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
# CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
# ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
# POSSIBILITY OF SUCH DAMAGE.

LOCKSS_PLATFORM_VERSION="Docker-2-alpha4"
LOCKSS_PRESERVATION_GROUP="{{LOCKSS_PRESERVATION_GROUP}}"
LOCKSS_NAMESPACE="lockss"
LOCKSS_GROUP={{LOCKSS_USER}}
LOCKSS_UID=$(id -u ${LOCKSS_USER})
LOCKSS_GID=$(id -g ${LOCKSS_GROUP})

LOCKSS_HOSTNAME_LOWERCASE="$(echo "${LOCKSS_HOSTNAME}" | tr A-Z a-z)"

MK_DATA_ROOT="{{LOCKSS_DATA_DIR}}"
MK_LOGS_ROOT="{{LOCKSS_LOGS_DIR}}"
MK_TMP_ROOT="{{LOCKSS_TMPDIR}}"
LOCKSS_WAIT_FILE=ready

STACK='{{STACK_NAME}}'
LOCKSS_LCAP_PORT='{{STACK_LCAP_PORT}}'
LOCKSS_UI_PORT='{{STACK_PORT_BASE}}00'
CFG_IMG='lockss/laaws-configuration-service'
CFG_VERSION='2.6.0-SNAPSHOT'
CFG_HOST="lockss-configuration-service"
CFG_DEFAULT_REST_PORT='24620'
CFG_REST_PORT='{{STACK_PORT_BASE}}20'
CFG_DEFAULT_UI_PORT='24621'
CFG_UI_PORT='{{STACK_PORT_BASE}}21'
CFG_URL="http://${CFG_HOST}:${CFG_REST_PORT}"

JMS_HOST="${CFG_HOST}"
JMS_DEFAULT_PORT='61616'
JMS_PORT='{{STACK_PORT_BASE}}06'

MDQ_IMG='lockss/laaws-metadata-service'
MDQ_VERSION='2.4.0-SNAPSHOT'
MDQ_HOST="lockss-metadata-service"
MDQ_DEFAULT_REST_PORT='24650'
MDQ_REST_PORT='{{STACK_PORT_BASE}}50'
MDQ_DEFAULT_UI_PORT='24651'
MDQ_UI_PORT='{{STACK_PORT_BASE}}51'

MDX_IMG='lockss/laaws-metadata-extraction-service'
MDX_VERSION='2.5.0-SNAPSHOT'
MDX_HOST="lockss-metadata-extraction-service"
MDX_DEFAULT_REST_PORT='24640'
MDX_REST_PORT='{{STACK_PORT_BASE}}40'
MDX_DEFAULT_UI_PORT='24641'
MDX_UI_PORT='{{STACK_PORT_BASE}}41'

POL_IMG='lockss/laaws-poller'
POL_VERSION='2.4.0-SNAPSHOT'
POL_HOST="lockss-poller-service"
POL_DEFAULT_REST_PORT='24630'
POL_REST_PORT='{{STACK_PORT_BASE}}30'
POL_DEFAULT_UI_PORT='24631'
POL_UI_PORT='{{STACK_PORT_BASE}}31'
POL_DEFAULT_LCAP_PORT='9729'
POL_LCAP_PORT='{{STACK_LCAP_PORT}}'

LOCKSS_DEFAULT_PROXY_PORT='24670'
LOCKSS_PROXY_PORT='{{STACK_PORT_BASE}}70'
LOCKSS_DEFAULT_AUDIT_PORT='24672'
LOCKSS_AUDIT_PORT='{{STACK_PORT_BASE}}72'
LOCKSS_DEFAULT_ICP_PORT='24674'
LOCKSS_ICP_PORT='{{STACK_PORT_BASE}}74'

REPO_IMG='lockss/laaws-repository-service'
REPO_VERSION='2.12.0-SNAPSHOT'
REPO_HOST='lockss-repository-service'
REPO_DEFAULT_REST_PORT='24610'
REPO_REST_PORT='{{STACK_PORT_BASE}}10'
REPO_LOCAL_BASEDIRS=${LOCKSS_REPO_CONTAINER_DIRS}
REPO_HDFS_BASEDIR='/lockss'
LOCKSS_REPO_CONTAINER_DIRS=${LOCKSS_REPO_CONTAINER_DIRS}
LOCKSS_CACHE_VOLS=${LOCKSS_REPO_HOST_DIRS}
REPO_ALLOWS_NOPASS={{USE_LOCKSS_OPENWB}}

# PostgreSQL database configuration
POSTGRES_IMG='postgres'
POSTGRES_VERSION='9.6.12-alpine'
POSTGRES_HOST="{{LOCKSS_POSTGRES_HOST}}"
POSTGRES_DEFAULT_PORT='{{LOCKSS_POSTGRES_PORT}}'
POSTGRES_PORT='{{STACK_PORT_BASE}}02'
#POSTGRES_PORT="${POSTGRES_DEFAULT_PORT}"
POSTGRES_USER='{{LOCKSS_POSTGRES_USER}}'
POSTGRES_SCHEMA='{{LOCKSS_POSTGRES_SCHEMA}}'
POSTGRES_DB=postgres

# Solr container configuration
SOLR_IMG='solr'
SOLR_VERSION='8.9.0-slim'
SOLR_HOST={{LOCKSS_SOLR_HOST}}
SOLR_DEFAULT_PORT={{LOCKSS_SOLR_PORT}}
SOLR_PORT='{{STACK_PORT_BASE}}03'
#SOLR_PORT="${SOLR_DEFAULT_PORT}"
SOLR_CORE_REPO="{{LOCKSS_SOLR_CORE_REPO}}"
SOLR_CMD="solr-precreate"
SOLR_CONFIGSET="/opt/solr/server/solr/configsets/lockss"

# HDFS container configuration
HDFS_IMG='lockss/lockss-hdfs'
HDFS_VERSION='1.3'
HDFS_HOST="lockss-hdfs"
HDFS_DEFAULT_FS_PORT='9000'
# Fixme:
HDFS_FS_PORT='{{STACK_PORT_BASE}}19'
HDFS_STATUI_PORT='50070'
HDFS_DNUI_PORT='50075'

# ServeContent
SERV_DEFAULT_PORT='24680'
SERV_PORT='{{STACK_PORT_BASE}}80'

# Pywb container settings
PYWB_IMG='lockss/lockss-pywb'
PYWB_VERSION='2.4.2-SNAPSHOT'
PYWB_HOST="lockss-pywb-service"
PYWB_DEFAULT_PORT='8080'
PYWB_PORT='{{STACK_PORT_BASE}}81'
#PYWB_PORT="${PYWB_DEFAULT_PORT}"

# OpenWayback container settings
OPENWB_IMG='lockss/lockss-openwayback'
OPENWB_VERSION='openwayback-2.4.0-SNAPSHOT'
OPENWB_HOST="lockss-openwayback-service"
OPENWB_DEFAULT_PORT='8080'
#OPENWB_PORT='{{STACK_PORT_BASE}}82'
OPENWB_PORT="${OPENWB_DEFAULT_PORT}"
